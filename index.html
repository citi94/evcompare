<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EV vs Petrol Cost Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
    }

    .container {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        padding: 40px;
        max-width: 800px;
        width: 100%;
        animation: fadeIn 0.8s ease-out;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
    }

    h1 {
        text-align: center;
        color: #2d3748;
        margin-bottom: 10px;
        font-size: 2.5rem;
        font-weight: 300;
    }

    .subtitle {
        text-align: center;
        color: #718096;
        margin-bottom: 40px;
        font-size: 1.1rem;
    }

    .comparison-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 40px;
        margin-bottom: 40px;
    }

    .vehicle-section {
        background: #f7fafc;
        border-radius: 15px;
        padding: 30px;
        border: 2px solid transparent;
        transition: all 0.3s ease;
    }

    .vehicle-section:hover {
        border-color: #667eea;
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.1);
    }

    .vehicle-section h2 {
        color: #2d3748;
        margin-bottom: 25px;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .icon {
        font-size: 1.8rem;
    }

    .control-group {
        margin-bottom: 25px;
    }

    .control-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    label {
        font-weight: 600;
        color: #4a5568;
        font-size: 0.95rem;
    }

    .value-display {
        font-weight: bold;
        color: #2d3748;
        font-size: 1.1rem;
        min-width: 80px;
        text-align: right;
    }

    .slider-container {
        position: relative;
        margin-bottom: 10px;
    }

    input[type="range"] {
        width: 100%;
        height: 8px;
        border-radius: 5px;
        background: #e2e8f0;
        outline: none;
        appearance: none;
        transition: all 0.3s ease;
    }

    input[type="range"]::-webkit-slider-thumb {
        appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #667eea;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 6px rgba(102, 126, 234, 0.3);
    }

    input[type="range"]::-webkit-slider-thumb:hover {
        transform: scale(1.2);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    input[type="range"]::-moz-range-thumb {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #667eea;
        cursor: pointer;
        border: none;
        box-shadow: 0 2px 6px rgba(102, 126, 234, 0.3);
    }

    .lock-control {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-top: 8px;
    }

    input[type="checkbox"] {
        width: 18px;
        height: 18px;
        accent-color: #667eea;
    }

    .lock-label {
        font-size: 0.85rem;
        color: #718096;
    }

    .charging-losses {
        background: #fff5f5;
        border: 1px solid #fed7d7;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 30px;
    }

    .charging-losses h3 {
        color: #c53030;
        margin-bottom: 15px;
        font-size: 1.1rem;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .equivalence-display {
        background: linear-gradient(135deg, #48bb78, #38a169);
        color: white;
        padding: 25px;
        border-radius: 15px;
        text-align: center;
        font-size: 1.2rem;
        font-weight: 600;
        box-shadow: 0 8px 20px rgba(72, 187, 120, 0.3);
        margin-top: 30px;
    }

    .unit-toggle {
        position: absolute;
        top: 20px;
        right: 20px;
        background: rgba(255, 255, 255, 0.9);
        border: none;
        padding: 10px 15px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.3s ease;
    }

    .unit-toggle:hover {
        background: white;
        transform: translateY(-1px);
    }

    @media (max-width: 768px) {
        .container {
            padding: 20px;
            margin: 10px;
        }
        
        .comparison-grid {
            grid-template-columns: 1fr;
            gap: 20px;
        }
        
        h1 {
            font-size: 2rem;
        }
        
        .vehicle-section {
            padding: 20px;
        }
    }
</style>
```

</head>
<body>
    <div class="container">
        <button class="unit-toggle" onclick="toggleUnits()">üåç Switch Units</button>

```
    <h1>EV vs Petrol Calculator</h1>
    <p class="subtitle">Compare the running costs of electric and petrol vehicles</p>
    
    <div class="charging-losses">
        <h3>‚ö° Charging Losses</h3>
        <div class="control-group">
            <div class="control-header">
                <label>
                    <input type="checkbox" id="includeLosses" onchange="toggleLosses()">
                    Include charging losses
                </label>
                <span class="value-display" id="lossesValue">10.0%</span>
            </div>
            <div class="slider-container">
                <input type="range" id="lossesSlider" min="0" max="30" step="0.1" value="10" 
                       oninput="updateLosses()" disabled>
            </div>
        </div>
    </div>

    <div class="comparison-grid">
        <div class="vehicle-section">
            <h2><span class="icon">üîã</span>Electric Vehicle</h2>
            
            <div class="control-group">
                <div class="control-header">
                    <label>Efficiency</label>
                    <span class="value-display" id="efficiencyValue">4.0 mi/kWh</span>
                </div>
                <div class="slider-container">
                    <input type="range" id="efficiencySlider" min="1" max="10" step="0.1" value="4" 
                           oninput="updateCalculations('efficiency')">
                </div>
                <div class="lock-control">
                    <input type="checkbox" id="lockEfficiency" onchange="updateLocks()">
                    <label class="lock-label">Lock this value</label>
                </div>
            </div>

            <div class="control-group">
                <div class="control-header">
                    <label>Electricity Cost</label>
                    <span class="value-display" id="electricityCostValue">55.0 p/kWh</span>
                </div>
                <div class="slider-container">
                    <input type="range" id="electricityCostSlider" min="0.1" max="150" step="0.1" value="55" 
                           oninput="updateCalculations('electricityCost')">
                </div>
                <div class="lock-control">
                    <input type="checkbox" id="lockElectricityCost" onchange="updateLocks()">
                    <label class="lock-label">Lock this value</label>
                </div>
            </div>
        </div>

        <div class="vehicle-section">
            <h2><span class="icon">‚õΩ</span>Petrol Vehicle</h2>
            
            <div class="control-group">
                <div class="control-header">
                    <label>Fuel Economy</label>
                    <span class="value-display" id="mpgValue">44.0 mpg</span>
                </div>
                <div class="slider-container">
                    <input type="range" id="mpgSlider" min="1" max="200" step="0.1" value="44" 
                           oninput="updateCalculations('mpg')">
                </div>
                <div class="lock-control">
                    <input type="checkbox" id="lockMpg" onchange="updateLocks()">
                    <label class="lock-label">Lock this value</label>
                </div>
            </div>

            <div class="control-group">
                <div class="control-header">
                    <label>Petrol Cost</label>
                    <span class="value-display" id="petrolCostValue">133.9 p/L</span>
                </div>
                <div class="slider-container">
                    <input type="range" id="petrolCostSlider" min="10" max="200" step="0.1" value="133.9" 
                           oninput="updateCalculations('petrolCost')">
                </div>
                <div class="lock-control">
                    <input type="checkbox" id="lockPetrolCost" onchange="updateLocks()">
                    <label class="lock-label">Lock this value</label>
                </div>
            </div>
        </div>
    </div>

    <div class="equivalence-display" id="equivalenceDisplay">
        EV: 4.0 mi/kWh @ 55.0p/kWh = Petrol: 44.0 mpg @ 133.9p/L
        <br><small>Cost per mile: 13.8p</small>
    </div>
</div>

<script>
    // Unit system: 'uk' or 'us'
    let unitSystem = 'uk';
    
    // Conversion constants
    const IMPERIAL_GALLON_TO_LITRES = 4.54609;
    const US_GALLON_TO_LITRES = 3.78541;
    
    // Current values
    let values = {
        efficiency: 4.0,        // mi/kWh
        electricityCost: 55.0,  // p/kWh
        mpg: 44.0,             // miles per gallon
        petrolCost: 133.9,     // p/L
        chargingLosses: 10.0,  // percentage
        includeLosses: false
    };
    
    // Lock states
    let locks = {
        efficiency: false,
        electricityCost: false,
        mpg: false,
        petrolCost: false
    };

    function updateDisplay() {
        const efficiencyUnit = unitSystem === 'uk' ? 'mi/kWh' : 'mi/kWh';
        const electricityUnit = unitSystem === 'uk' ? 'p/kWh' : '¬¢/kWh';
        const mpgUnit = unitSystem === 'uk' ? 'mpg' : 'mpg';
        const petrolUnit = unitSystem === 'uk' ? 'p/L' : '¬¢/gal';
        
        document.getElementById('efficiencyValue').textContent = `${values.efficiency.toFixed(1)} ${efficiencyUnit}`;
        document.getElementById('electricityCostValue').textContent = `${values.electricityCost.toFixed(1)} ${electricityUnit}`;
        document.getElementById('mpgValue').textContent = `${values.mpg.toFixed(1)} ${mpgUnit}`;
        document.getElementById('petrolCostValue').textContent = `${values.petrolCost.toFixed(1)} ${petrolUnit}`;
        document.getElementById('lossesValue').textContent = `${values.chargingLosses.toFixed(1)}%`;
        
        updateEquivalenceDisplay();
    }

    function updateEquivalenceDisplay() {
        // Calculate cost per mile for EV
        let evCostPerMile = values.electricityCost / values.efficiency;
        if (values.includeLosses) {
            evCostPerMile *= (1 + values.chargingLosses / 100);
        }
        
        // Calculate cost per mile for petrol
        const gallonToLitres = unitSystem === 'uk' ? IMPERIAL_GALLON_TO_LITRES : US_GALLON_TO_LITRES;
        const petrolCostPerMile = (values.petrolCost * gallonToLitres) / values.mpg;
        
        const efficiencyUnit = unitSystem === 'uk' ? 'mi/kWh' : 'mi/kWh';
        const electricityUnit = unitSystem === 'uk' ? 'p/kWh' : '¬¢/kWh';
        const mpgUnit = unitSystem === 'uk' ? 'mpg' : 'mpg';
        const petrolUnit = unitSystem === 'uk' ? 'p/L' : '¬¢/gal';
        const costUnit = unitSystem === 'uk' ? 'p' : '¬¢';
        
        let displayText = `EV: ${values.efficiency.toFixed(1)} ${efficiencyUnit} @ ${values.electricityCost.toFixed(1)}${electricityUnit}`;
        if (values.includeLosses) {
            displayText += ` (+${values.chargingLosses.toFixed(1)}% losses)`;
        }
        displayText += ` = Petrol: ${values.mpg.toFixed(1)} ${mpgUnit} @ ${values.petrolCost.toFixed(1)}${petrolUnit}`;
        displayText += `<br><small>Cost per mile: ${evCostPerMile.toFixed(1)}${costUnit}</small>`;
        
        document.getElementById('equivalenceDisplay').innerHTML = displayText;
    }

    function updateCalculations(changedParam) {
        // Count locked parameters
        const lockedCount = Object.values(locks).filter(Boolean).length;
        
        if (lockedCount >= 2) {
            // If 2 parameters are locked, only update displays
            updateSliderValues();
            updateDisplay();
            return;
        }
        
        // Calculate cost per mile for the changed side
        let evCostPerMile, petrolCostPerMile;
        const gallonToLitres = unitSystem === 'uk' ? IMPERIAL_GALLON_TO_LITRES : US_GALLON_TO_LITRES;
        
        if (changedParam === 'efficiency' || changedParam === 'electricityCost') {
            // EV side changed, calculate equivalent petrol values
            evCostPerMile = values.electricityCost / values.efficiency;
            if (values.includeLosses) {
                evCostPerMile *= (1 + values.chargingLosses / 100);
            }
            
            // Update petrol values to match
            if (!locks.mpg && !locks.petrolCost) {
                // Neither petrol value is locked, keep ratio
                const currentPetrolCostPerMile = (values.petrolCost * gallonToLitres) / values.mpg;
                const ratio = evCostPerMile / currentPetrolCostPerMile;
                values.petrolCost *= ratio;
            } else if (!locks.mpg) {
                // Petrol cost is locked, adjust MPG
                values.mpg = (values.petrolCost * gallonToLitres) / evCostPerMile;
            } else if (!locks.petrolCost) {
                // MPG is locked, adjust petrol cost
                values.petrolCost = (evCostPerMile * values.mpg) / gallonToLitres;
            }
        } else {
            // Petrol side changed, calculate equivalent EV values
            petrolCostPerMile = (values.petrolCost * gallonToLitres) / values.mpg;
            
            // Update EV values to match
            if (!locks.efficiency && !locks.electricityCost) {
                // Neither EV value is locked, keep ratio
                let currentEvCostPerMile = values.electricityCost / values.efficiency;
                if (values.includeLosses) {
                    currentEvCostPerMile *= (1 + values.chargingLosses / 100);
                }
                const ratio = petrolCostPerMile / currentEvCostPerMile;
                values.electricityCost *= ratio;
            } else if (!locks.efficiency) {
                // Electricity cost is locked, adjust efficiency
                let targetCostPerKwh = petrolCostPerMile;
                if (values.includeLosses) {
                    targetCostPerKwh /= (1 + values.chargingLosses / 100);
                }
                values.efficiency = values.electricityCost / targetCostPerKwh;
            } else if (!locks.electricityCost) {
                // Efficiency is locked, adjust electricity cost
                values.electricityCost = petrolCostPerMile * values.efficiency;
                if (values.includeLosses) {
                    values.electricityCost /= (1 + values.chargingLosses / 100);
                }
            }
        }
        
        updateSliderValues();
        updateDisplay();
    }

    function updateSliderValues() {
        document.getElementById('efficiencySlider').value = Math.max(1, Math.min(10, values.efficiency));
        document.getElementById('electricityCostSlider').value = Math.max(0.1, Math.min(150, values.electricityCost));
        document.getElementById('mpgSlider').value = Math.max(1, Math.min(200, values.mpg));
        document.getElementById('petrolCostSlider').value = Math.max(10, Math.min(200, values.petrolCost));
    }

    function updateFromSlider(param) {
        switch(param) {
            case 'efficiency':
                values.efficiency = parseFloat(document.getElementById('efficiencySlider').value);
                break;
            case 'electricityCost':
                values.electricityCost = parseFloat(document.getElementById('electricityCostSlider').value);
                break;
            case 'mpg':
                values.mpg = parseFloat(document.getElementById('mpgSlider').value);
                break;
            case 'petrolCost':
                values.petrolCost = parseFloat(document.getElementById('petrolCostSlider').value);
                break;
        }
    }

    // Event handlers for sliders
    document.getElementById('efficiencySlider').addEventListener('input', function() {
        updateFromSlider('efficiency');
        updateCalculations('efficiency');
    });

    document.getElementById('electricityCostSlider').addEventListener('input', function() {
        updateFromSlider('electricityCost');
        updateCalculations('electricityCost');
    });

    document.getElementById('mpgSlider').addEventListener('input', function() {
        updateFromSlider('mpg');
        updateCalculations('mpg');
    });

    document.getElementById('petrolCostSlider').addEventListener('input', function() {
        updateFromSlider('petrolCost');
        updateCalculations('petrolCost');
    });

    function updateLocks() {
        locks.efficiency = document.getElementById('lockEfficiency').checked;
        locks.electricityCost = document.getElementById('lockElectricityCost').checked;
        locks.mpg = document.getElementById('lockMpg').checked;
        locks.petrolCost = document.getElementById('lockPetrolCost').checked;
        
        // Ensure maximum 2 locks
        const lockedCount = Object.values(locks).filter(Boolean).length;
        if (lockedCount > 2) {
            // Find the most recently checked box and uncheck others
            const checkboxes = ['lockEfficiency', 'lockElectricityCost', 'lockMpg', 'lockPetrolCost'];
            let checkedBoxes = [];
            
            checkboxes.forEach(id => {
                if (document.getElementById(id).checked) {
                    checkedBoxes.push(id);
                }
            });
            
            // Keep only the last 2 checked
            if (checkedBoxes.length > 2) {
                for (let i = 0; i < checkedBoxes.length - 2; i++) {
                    document.getElementById(checkedBoxes[i]).checked = false;
                    const param = checkedBoxes[i].replace('lock', '').toLowerCase();
                    if (param === 'electricitycost') locks.electricityCost = false;
                    else if (param === 'petrolcost') locks.petrolCost = false;
                    else locks[param] = false;
                }
            }
        }
    }

    function toggleLosses() {
        values.includeLosses = document.getElementById('includeLosses').checked;
        document.getElementById('lossesSlider').disabled = !values.includeLosses;
        updateCalculations('efficiency'); // Recalculate with/without losses
    }

    function updateLosses() {
        values.chargingLosses = parseFloat(document.getElementById('lossesSlider').value);
        updateDisplay();
        if (values.includeLosses) {
            updateCalculations('efficiency');
        }
    }

    function toggleUnits() {
        // This is a placeholder for unit conversion
        // In a full implementation, you would convert all values between UK and US units
        if (unitSystem === 'uk') {
            unitSystem = 'us';
            // Convert values to US units
            // values.petrolCost = values.petrolCost * US_GALLON_TO_LITRES / IMPERIAL_GALLON_TO_LITRES;
            alert('US units not fully implemented in this demo. This would convert pence/litre to cents/gallon, etc.');
            unitSystem = 'uk'; // Revert for now
        } else {
            unitSystem = 'uk';
        }
        updateDisplay();
    }

    // Initialize
    updateDisplay();
</script>
```

</body>
</html>